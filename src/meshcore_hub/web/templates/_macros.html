{# Reusable macros for templates #}

{#
  Pagination macro

  Parameters:
    - page: Current page number
    - total_pages: Total number of pages
    - params: Dict of query parameters to preserve (e.g., {"search": "foo", "limit": 50})
#}
{% macro pagination(page, total_pages, params={}) %}
{% if total_pages > 1 %}
{% set query_parts = [] %}
{% for key, value in params.items() %}
{% if value is not none and value != '' %}
{% set _ = query_parts.append(key ~ '=' ~ value) %}
{% endif %}
{% endfor %}
{% set base_query = query_parts|join('&') %}
{% set query_prefix = '&' if base_query else '' %}
<div class="flex justify-center mt-6">
    <div class="join">
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}{{ query_prefix }}{{ base_query }}" class="join-item btn btn-sm">Previous</a>
        {% else %}
        <button class="join-item btn btn-sm btn-disabled">Previous</button>
        {% endif %}

        {% for p in range(1, total_pages + 1) %}
            {% if p == page %}
            <button class="join-item btn btn-sm btn-active">{{ p }}</button>
            {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
            <a href="?page={{ p }}{{ query_prefix }}{{ base_query }}" class="join-item btn btn-sm">{{ p }}</a>
            {% elif p == 2 or p == total_pages - 1 %}
            <button class="join-item btn btn-sm btn-disabled">...</button>
            {% endif %}
        {% endfor %}

        {% if page < total_pages %}
        <a href="?page={{ page + 1 }}{{ query_prefix }}{{ base_query }}" class="join-item btn btn-sm">Next</a>
        {% else %}
        <button class="join-item btn btn-sm btn-disabled">Next</button>
        {% endif %}
    </div>
</div>
{% endif %}
{% endmacro %}
